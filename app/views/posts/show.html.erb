<% provide(:page_title, @post.title) %>

<div class="card">
	<div class="col-md-10 col-md-offset-2 col-lg-8 col-lg-offset-2">
		<h1 class="text-center"><%= @post.title %></h1>
		<p class="text-center"><small>
			<%= @post.display_day_published %> | <%= @post.user.email %>
		</small></p>
		<p class="text-justify"><%= @post.body %></p>
		<div class="pull-right">
			<% if user_signed_in? && current_user == @post.user %>
			<%= link_to '<i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit'.html_safe, edit_post_path(@post), class:'btn btn-primary' %>
			<%= link_to '<i class="fa fa-trash" aria-hidden="true"></i> Delete'.html_safe, post_path(@post), method: :delete, 
			data: { confirm: "Are you sure you want to delete this post?" }, 
			class: "btn btn-danger btn-space" %>
			<% end %>
			<%= link_to '<i class="fa fa-arrow-left" aria-hidden="true"></i> Back'.html_safe, posts_path, class:'btn btn-warning' %>		
		</div>
	</div>
</div>
<hr>

<!-- Comments Session -->
<div class='col-md-12'>
	<%= form_for [@post, @comment ], remote: true,
	:html => {class: "form-horizontal", role: "form"} do |f| %>
	<% if @comment.errors.any? %>
	<div class="panel panel-danger col-md-offset-1">
		<div class="panel-heading"> 
			<h2 class="panel-title">
				<%= pluralize(@comment.errors.count, "error") %>
				prohibited this comment from being saved: 
			</h2>
			<div class="panel-body"> 
				<ul>
					<% @comment.errors.full_messages.each do |msg| %> 
					<li> <%= msg %> </li>
					<% end %> 
				</ul>
			</div>
		</div> 
	</div>
	<% end %>
	<div class='form-group'>
		<div class='control-label col-md-2'>
			<%= f.label :body, 'New Comment' %> 
		</div>
		<div class='col-md-10'>
			<%= f.text_area :body, rows: 10, class: 'form-control', placeholder: 'Your comment' %> 
		</div>
	</div>
	<div class='form-group'>
		<div class='col-md-offset-2 col-md-10'>
			<%= f.submit 'Add Comment', class: 'btn btn-primary btn-lg pull-right' %> 
		</div>
	</div> 
	<% end %>
</div>
<!-- Comments History -->
<div class='col-md-12'> 
	<header>
		<h2>Comments</h2> 
	</header>
	<div class="col-md-10">
		<% if @post.comments.any? %>
			<div id="messages">
				<% persisted_comments(@comments).each do |comment| %> 
				<div class="comment-body">
					<%= comment.body %> 
				</div>
				
				<div class="comment-time">
					<%= time_ago_in_words(comment.created_at) %> 
					ago by <%= comment.user.email %>
				</div>
				<hr>
				<% end %>
			</div>
		<% else %>
		There are no comments to show.
		<% end %> 
	</div>
</div>